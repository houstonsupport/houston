/* Houston Compiled, built Sun Apr 12 2015 23:45:58 */var LoginModel=Backbone.Model.extend({url:"/api/auth/login"}),RegisterModel=Backbone.Model.extend({url:"/api/register"}),LoginView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/register">Try Houston for 60 days, absolutely free!</a></div><div class="box box-log"><h2>Login Here</h2><h3 class="log-tag">Great to see you again!</h3><form id="form-log"><input class="required" type="email" name="log-e" placeholder="Email Address" autofocus /><input class="required" type="password" name="log-p" placeholder="Password" /><label><input id="log-rem" type="checkbox" name="log-r" value="remember" />Remember me on this computer</label><button class="login" type="button">Sign In</button></form><h3 class="ib">Help!</h3>&nbsp;<a class="forgot">Ive forgotten my password</a></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/register">Lets Go</a></div>'),templatePass:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/#/register">Try Houston for 60 days, absolutely free!</a></div><div class="box box-pass"><h2>Reset Your Password</h2><h3 class="pass-tag">Out with the old in with the new!</h3><form id="form-pass"><input class="required" type="email" name="pass-e" placeholder="Email Address" /><h3>A reset link will be sent to this email address, click the link and follow the simple directions.</h3><button class="reset" type="button">Reset</button></form><div class="beige">or</div><a class="btn-can">Cancel</a></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/register">Lets Go</a></div>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .forgot":"passwordView","click .btn-can":"resetCancel","click .login":"login","click .reset":"resetPassword"}),this},keyEvent:function(a){var b=a.which;13==b&&this.keyEventFormHandler()},loginMode:!0,keyEventFormHandler:function(){this.loginMode?this.login():this.resetPassword()},passwordView:function(){this.loginMode=!1,this.model.clear(),this.$el.html(this.templatePass())},resetCancel:function(){this.loginMode=!0,this.model.clear(),this.render()},login:function(){login.validateForm(this.$el.find("#form-log"))&&(this.model.url="/api/auth/login",this.model.set({user:this.$el.find('input[name="log-e"]').val(),password:this.$el.find('input[name="log-p"]').val(),remember:this.$el.find('input[name="log-r"]').is(":checked")}),this.model.save(this.model.attributes,{success:function(a,b,c){window.location.reload()},error:_.bind(function(a,b,c){console.log(this.model),this.$el.find(".box-log h2").text("Oops!"),this.$el.find(".box-log h3.log-tag").text("Please try again")},this)}))},resetPassword:function(){login.validateForm(this.$el.find("#form-pass"))&&(this.model.url="/api/auth/reset",this.model.set({emailAddress:this.$el.find('input[name="pass-e"]').val()}),this.model.save(this.model.attributes,{success:_.bind(function(a,b,c){this.$el.html(this.template()),this.$el.find(".box-log h2").text("Reset Request Sent"),this.$el.find(".box-log h3.log-tag").text("Please check your email")},this),error:_.bind(function(a,b,c){this.$el.find(".box-pass h2").text("Oops!"),this.$el.find(".box-pass h3.pass-tag").text("We dont recognise that email address.")},this)}))}}),RegisterView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-reg"><h2>Create an Account</h2><h3>Just this one easy form and you\'re done!</h3><div class="reg-form-wrap"><form id="form-reg" action=""><div class="vld-wrap vld-pair-one"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">1</div></div></div><input type="text" name="reg-fn" placeholder="First Name" class="vld-aa" data-vld="vld-a" val="{{attributes.firstName}}" autofocus /><input class="inp-spa vld-bb" type="text" name="reg-ln" placeholder="Last Name" data-vld="vld-b" val="{{attributes.lastName}}" /></div><div class="vld-wrap vld-pair-two"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">2</div></div></div><div class="reg-vrf"><input type="email" name="reg-e" placeholder="Email Address" class="email vld-aa" data-vld="vld-a" val="{{attributes.emailAddress}}" /><div class="vrf"><div class="vrf-cir"><i class="icon-cancel"></i></div><div class="vrf-msg">Already<br />In Use</div></div></div><div class="reg-vrf"><input class="inp-spa vld-bb company" type="text" name="reg-c" placeholder="Company" data-vld="vld-b" val="{{attributes.company}}" /><div class="vrf"><div class="vrf-cir"><i class="icon-cancel"></i></div><div class="vrf-msg">Already<br />In Use</div></div></div></div><div class="vld-wrap vld-pair-three"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">3</div></div></div><div class="reg-vrf"><input type="password" class="reg-p vld-aa" name="reg-p" placeholder="Password" class="vld-aa" data-vld="vld-a" /><div class="vrf"><div class="vrf-cir vrf-count">8</div><div class="vrf-msg"></div></div></div><div class="reg-vrf"><input class="inp-lst vld-bb" type="password" name="register-password-confirm" placeholder="Repeat Password" data-vld="vld-b" disabled="disabled" /><div class="vrf"><div class="vrf-cir ok"><i class="icon-ok-1"></i></i></div><div class="vrf-msg"></div></div></div></div><button class="detailsConfirm" type="button">Confirm</button><div class="beige or">or</div><a class="btn-can" href="/">Cancel</a></form></div>'),paymentPlanTemplate:Handlebars.compile('<div class="box box-reg"><h2>Choose a Pricing Plan</h2><h3>How much Houston do you want {{attributes.firstName}}?</h3><div class="reg-form-wrap"><form id="form-payment-plan" action=""><div class="form-row"><label><span>Houston Plan 1 - Unlimited Access - Monthly</span><input class="radio1" type="radio" name="plan" value="1" /></label></div><div class="form-row"><label><span>Houston Plan 2 - Unlimited Access - Annually</span><input class="radio2" type="radio" name="plan" value="2" /></label></div><button class="planConfirm" type="button">Confirm</button><div class="beige or">or</div><a class="btn-can" href="/">Cancel</a></form></div>'),paymentTemplate:Handlebars.compile('<div class="box box-reg"><h2>Enter Your Payment Details</h2><h3>Almost got your Houston account!</h3><div class="reg-form-wrap"><form id="form-payment" action=""><span class="payment-errors"></span><div class="form-row"><label><span>Card Number</span><input type="text" size="20" data-stripe="number" /></label></div><div class="form-row"><label><span>CVC</span><input type="text" size="4" data-stripe="cvc" /></label></div><div class="form-row"><label><span>Expiration (MM/YYYY)</span><input type="text" size="2" data-stripe="exp-month" /></label><span> / </span><input type="text" size="4" data-stripe="exp-year" /></div><button class="paymentConfirm" type="button">Confirm</button><div class="beige or">or</div><a class="btn-can" href="/">Cancel</a></form></div>'),templateSuccess:Handlebars.compile('<div class="box box-suc"><h2>You Have a Houston Account!</h2><h3>Hoot have thought it would be so easy?</h3><div class="got-wrap"><h2>You\'ve Got Mail!</h2><h3>Please click the verification link in the email we just sent you to complete your account creation</h3></div></div>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.model.set({password:""}),this.$el.html(this.template(this.model)),this.delegateEvents({"click .detailsConfirm":"detailsConfirm","blur input":"validate","focus .reg-p":"showCount","input .reg-p":"passCount","input .inp-lst":"passMatch","focus .email":"hideAlert","focus .company":"hideAlert",keydown:"keyEvent"}),this},keyEvent:function(a){var b=a.which;27==b?window.location.href="http://"+window.location.hostname:13==b&&(this.$el.find("form").focus(),this.detailsConfirm())},passMatch:function(a){login.registerPasswordMatch(a.currentTarget)},passCount:function(a){login.registerPasswordCount(a.currentTarget,this.$el)},showCount:function(a){login.registerPasswordShowCount(a.currentTarget)},validate:function(a){login.inputValidation(a.currentTarget)},detailsConfirm:function(){login.registerCreateValidate(this.$el)&&(this.model.set({firstName:this.$el.find('input[name="reg-fn"]').val().capitalize(),lastName:this.$el.find('input[name="reg-ln"]').val().capitalize(),emailAddress:this.$el.find('input[name="reg-e"]').val(),company:this.$el.find('input[name="reg-c"]').val(),password:this.$el.find('input[name="reg-p"]').val()}),this.$el.html(this.paymentPlanTemplate(this.model)),this.delegateEvents({"click .planConfirm":"planConfirm"}))},planConfirm:function(){this.model.set({plan:this.$el.find('input[type="radio"]:checked').val()}),this.$el.html(this.paymentTemplate(this.model)),this.delegateEvents({"click .paymentConfirm":"paymentConfirm"})},paymentConfirm:function(){var a=this.$el.find("form");Stripe.card.createToken(a,this.responseHandler)},responseHandler:function(a,b){var c=$("#form-payment");b.error?c.find(".payment-errors").text(b.error.message):(app.registerModel.set({stripeToken:b.id}),app.registerModel.save(app.registerModel.attributes,{success:function(a,b,c){console.log(b),app.registerView.$el.html(app.registerView.templateSuccess())},error:function(a,b,c){console.log(b)}}))}}),ResetView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/#/register">Try Houston for 60 days, absolutely free!</a></div><div class="box box-log"><h2>Change Password</h2><h3 class="log-tag">Please enter a new password below</h3><form id="form-log"><input type="password" name="pass" placeholder="Password" /><input type="password" name="pass-c" placeholder="Confirm Password" /><button class="reset" type="button">Confirm</button></form></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/#/register">Lets Go</a></div>'),initialize:function(){},render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .reset":"reset"}),this},reset:function(a){return this.$el.find("input[name=pass]").val()!==this.$el.find('input[name="pass-c"]').val()?(this.$el.find(".box-log h2").text("Oops!"),void this.$el.find(".box-log h3.log-tag").text("Please ensure passwords match")):(this.model.url="/api/auth/reset/complete",this.model.set({password:this.$el.find('input[name="pass-c"]').val()}),void this.model.save(this.model.attributes,{success:_.bind(function(a,b,c){1===b?window.location.href="/":(this.$el.find(".box-log h2").text("Oops!"),this.$el.find(".box-log h3.log-tag").text("Something went wrong"))},this)}))}});Backbone.View.prototype.close=function(){this.remove(),this.unbind(),this.onClose&&this.onClose()};var AppRouter=Backbone.Router.extend({root:"/",routes:{"":"login","reset/:token":"reset",register:"register"},initialize:function(){this.loginModel=new LoginModel,this.registerModel=new RegisterModel,this.appElement=$("#app")},currentView:!1,showView:function(a){this.currentView&&this.currentView.close(),this.currentView=a,$("#app").html(this.currentView.render().el)},login:function(){var a=new LoginView({model:this.loginModel});this.showView(a)},reset:function(a){var b=new ResetView({model:this.loginModel});b.model.set("token",a),this.showView(b)},register:function(){var a=new RegisterView({model:this.registerModel});this.showView(a)}}),app=new AppRouter;$(function(){Backbone.history.start({pushState:!0,root:app.root})}),$(document).on("click","a[href]:not([data-bypass])",function(a){var b={prop:$(this).prop("href"),attr:$(this).attr("href")},c=location.protocol+"//"+location.host+app.root;b.prop.slice(0,c.length)===c&&(a.preventDefault(),Backbone.history.navigate(b.attr,!0))}),String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})};var login={validateForm:function(a){var b=!0,c=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,a=$(a),d=a.find(".required");return d.each(function(){var a=$(this);""==a.val()?(a.addClass("error"),b=!1):a.removeClass("error"),a.is("input[type=email]")&&(address=a.val(),c.test(address)?a.removeClass("error"):(b=!1,a.addClass("error")))}),b},inputValidation:function(a){var b=!0,a=$(a),c=a.val(),d=c.length,e=a.data("vld"),f=a.closest(".vld-wrap");c||(b=!1),b&&(a.is("input[type=email]")&&(b=this.emailValidation(a,c,f,e)),a.hasClass("company")&&this.companyValidation(a,c,f,e),a.hasClass("reg-p")&&(b=this.passwordValidation(c,d)),a.hasClass("inp-lst")&&(b=this.repeatPasswordValidation(c))),b?f.addClass(e):f.removeClass(e),(a.hasClass("reg-p")||a.hasClass("inp-lst"))&&this.registerHideAlert(a)},emailValidation:function(a,b,c,d){var e=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;if(!e.test(b))return a.addClass("error"),c.removeClass(d),!1;a.removeClass("error");var f=$.get("/api/check/email?email="+b);f.done(function(b){login.successfulAjaxValidation(a,c,d)}),f.fail(function(b,e){login.failedAjaxValidation(a,c,d)})},companyValidation:function(a,b,c,d){var e=$.get("/api/check/company?company="+b);e.done(function(b){login.successfulAjaxValidation(a,c,d)}),e.fail(function(b,e){login.failedAjaxValidation(a,c,d)})},successfulAjaxValidation:function(a,b,c){a.removeClass("in-use"),a.closest(".reg-vrf").find(".vrf").fadeOut(),b.addClass(c)},failedAjaxValidation:function(a,b,c){a.addClass("in-use"),a.closest(".reg-vrf").find(".vrf").fadeIn(),b.removeClass(c)},validatedPassword:!1,passwordValidation:function(a,b){return b>=8?(this.validatedPassword=a,!0):!1},registerHideAlert:function(a){$(a).closest(".reg-vrf").find(".vrf").fadeOut()},repeatPasswordValidation:function(a){return a==this.validatedPassword?!0:!1},registerPasswordShowCount:function(a){var a=$(a);login.validatedPassword!==a.val()&&a.closest(".reg-vrf").find(".vrf").fadeIn()},registerPasswordCount:function(a,b){var a=$(a),c=a.val().length,d=a.closest(".reg-vrf"),e=d.find(".vrf-count"),f=8,g=b.find(".inp-lst");8>c?(e.text(f-c),e.removeClass("ok"),this.validatedPassword=!1,d.find(".vrf").fadeIn(),g.val(""),g.prop("disabled",!0),g.closest(".reg-vrf").find(".vrf").fadeOut(),g.closest(".vld-wrap").removeClass("vld-a vld-b")):(e.html('<i class="icon-ok-1"></i>'),e.addClass("ok"),g.prop("disabled",!1))},registerPasswordMatch:function(a){var a=$(a),b=a.val(),c=a.closest(".reg-vrf"),d=c.find(".vrf"),e=a.data("vld"),f=a.closest(".vld-wrap");if(b==this.validatedPassword){var g=d.find(".vrf-cir"),h=d.find(".vrf-msg");g.addClass("ok").html('<i class="icon-ok-1"></i>'),h.html(""),d.fadeIn(),f.addClass(e)}else d.fadeOut(),f.removeClass(e)},registerCreateValidate:function(a){return 3==a.find("div.vld-a").length&&3==a.find("div.vld-b").length?!0:!1}};