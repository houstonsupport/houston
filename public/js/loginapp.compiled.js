/* Houston Compiled, built Thu May 07 2015 15:25:57 */var RegisterModel=Backbone.Model.extend({url:"/api/register"}),LoginView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/register">Try Houston for 60 days, absolutely free!</a></div><div id="login-form-wrap"></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/register">Lets Go</a></div>'),passReset:!1,render:function(){var a;return this.$el.html(this.template()),a=this.passReset?new ResetPassView:new LoginFormView,this.showForm(a),this},currentView:!1,showForm:function(a){this.currentView&&this.currentView.close(),this.currentView=a,this.$el.find("#login-form-wrap").append(this.currentView.$el),this.currentView.render()}}),LoginFormView=Backbone.View.extend({className:"box box-log",template:Handlebars.compile('<h2>Login Here</h2><h3 class="log-tag">Great to see you again!</h3><form id="form-log"><input class="required" type="email" name="log-e" placeholder="Email Address" autofocus /><input class="required" type="password" name="log-p" placeholder="Password" /><label><input id="log-rem" type="checkbox" name="log-r" value="remember" />Remember me on this computer</label><button class="login" type="button"><span>Sign In</span><img class="svg-dots" src="/application/assets/img/three-dots.svg" width="52" alt="Loading"></button></form><h3 class="ib">Help!</h3>&nbsp;<a class="forgot">Ive forgotten my password</a>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .forgot":"passwordView","click .login":"login"}),this},keyEvent:function(a){var b=a.which;13==b&&(a.preventDefault(),this.login())},passwordView:function(){app.currentView.passReset=!0,app.currentView.render()},login:function(){if(login.validateForm(this.$el.find("#form-log"))){this.$el.find("h2").show().removeClass("text-animate"),this.$el.find("h3.log-tag").show().removeClass("text-animate"),this.$el.find(".login").addClass("loading");var a={user:this.$el.find('input[name="log-e"]').val(),password:this.$el.find('input[name="log-p"]').val(),remember:this.$el.find('input[name="log-r"]').is(":checked")},b=$.ajax({url:"/api/auth/login",method:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json"});b.done(function(a){window.location.reload()}),b.fail(function(a,b){app.currentView.$el.find(".box-log h2").hide().text("Oops!").addClass("text-animate"),app.currentView.$el.find(".box-log h3.log-tag").hide().text("Please try again").addClass("text-animate"),app.currentView.$el.find(".login").removeClass("loading")})}}}),ResetPassView=Backbone.View.extend({className:"box box-pass",template:Handlebars.compile('<h2>Reset Your Password</h2><h3 class="pass-tag">Out with the old in with the new!</h3><form id="form-pass"><input class="required" type="email" name="pass-e" placeholder="Email Address" /><h3>A reset link will be sent to this email address, click the link and follow the simple directions.</h3><button class="reset" type="button">Reset</button></form><div class="beige">or</div><a class="btn-can">Cancel</a>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .btn-can":"resetCancel","click .reset":"resetPassword"}),this},keyEvent:function(a){var b=a.which;13===b?(a.preventDefault(),this.resetPassword()):27===b&&this.resetCancel()},resetCancel:function(){app.currentView.passReset=!1,app.currentView.render()},resetPassword:function(){if(login.validateForm(this.$el.find("#form-pass"))){this.$el.find("h2").show().removeClass("text-animate"),this.$el.find("h3.pass-tag").show().removeClass("text-animate");var a={emailAddress:this.$el.find('input[name="pass-e"]').val()},b=$.ajax({url:"/api/auth/reset",method:"POST",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",dataType:"json"});b.done(function(a){app.currentView.$el.find(".box-pass h2").hide().text("Reset Request Sent").addClass("text-animate"),app.currentView.$el.find(".box-pass h3.pass-tag").hide().text("Please check your email").addClass("text-animate")}),b.fail(function(a,b){app.currentView.$el.find(".box-pass h2").hide().text("Oops!").addClass("text-animate"),app.currentView.$el.find(".box-pass h3.pass-tag").hide().text("We dont recognise that email address.").addClass("text-animate")})}}}),RegisterView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-reg box-reg-form"><h2>Create an Account</h2><h3>Just this one easy form and you\'re done!</h3><div class="reg-form-wrap"><form id="form-reg" action=""><div class="vld-wrap vld-pair-one {{#if attributes.firstName}}vld-a{{/if}} {{#if attributes.lastName}}vld-b{{/if}}"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">1</div></div></div><input type="text" id="first-name" name="reg-fn" placeholder="First Name" class="vld-aa" data-vld="vld-a" value="{{attributes.firstName}}" autofocus /><input class="inp-spa vld-bb" type="text" name="reg-ln" placeholder="Last Name" data-vld="vld-b" value="{{attributes.lastName}}" /></div><div class="vld-wrap vld-pair-two {{#if attributes.emailAddress}}vld-a{{/if}} {{#if attributes.company}}vld-b{{/if}}"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">2</div></div></div><div class="reg-vrf"><input type="email" name="reg-e" placeholder="Email Address" class="email vld-aa" data-vld="vld-a" value="{{attributes.emailAddress}}" /><div class="vrf"><div class="vrf-cir"><i class="icon-cancel"></i></div><div class="vrf-msg">Already<br />In Use</div></div></div><div class="reg-vrf"><input class="inp-spa vld-bb company" type="text" name="reg-c" placeholder="Company" data-vld="vld-b" value="{{attributes.company}}" /><div class="vrf"><div class="vrf-cir"><i class="icon-cancel"></i></div><div class="vrf-msg">Already<br />In Use</div></div></div></div><div class="vld-wrap vld-pair-three"><div class="vld-box"><div class="vld"><div class="vld-line"></div><div class="vld-line line-btm"></div><div class="vld-cir vld-name">3</div></div></div><div class="reg-vrf"><input type="password" class="reg-p vld-aa" name="reg-p" placeholder="Password" class="vld-aa" data-vld="vld-a" /><div class="vrf"><div class="vrf-cir vrf-count">8</div><div class="vrf-msg"></div></div></div><div class="reg-vrf"><input class="inp-lst vld-bb" type="password" name="register-password-confirm" placeholder="Repeat Password" data-vld="vld-b" disabled="disabled" /><div class="vrf"><div class="vrf-cir ok"><i class="icon-ok-1"></i></i></div><div class="vrf-msg"></div></div></div></div><button class="details-confirm" type="button">Confirm</button><div class="beige or">or</div><a class="btn-can" href="/">Cancel</a></form></div>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.model.unset("password"),this.$el.html(this.template(this.model)),this.delegateEvents({"click .details-confirm":"detailsConfirm","blur input":"validate","focus .reg-p":"showCount","input .reg-p":"passCount","input .inp-lst":"passMatch","focus .email":"hideAlert","focus .company":"hideAlert"}),this},keyEvent:function(a){var b=a.which;27==b?window.location.href="http://"+window.location.hostname:13==b&&(this.$el.find("form").focus(),this.detailsConfirm())},passMatch:function(a){login.registerPasswordMatch(a.currentTarget)},passCount:function(a){login.registerPasswordCount(a.currentTarget,this.$el)},showCount:function(a){login.registerPasswordShowCount(a.currentTarget)},validate:function(a){login.inputValidation(a.currentTarget)},detailsConfirm:function(){if(login.registerCreateValidate(this.$el)){this.model.set({firstName:this.$el.find('input[name="reg-fn"]').val().capitalize(),lastName:this.$el.find('input[name="reg-ln"]').val().capitalize(),emailAddress:this.$el.find('input[name="reg-e"]').val(),company:this.$el.find('input[name="reg-c"]').val(),password:this.$el.find('input[name="reg-p"]').val()});var a=new PlanView({model:this.model});app.showView(a)}}}),PlanView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-reg"><div class="box-plan"><h2><span>Choose a Pricing Plan</span></h2><h3><span>After your 60 day free trial which pricing plan suits you best {{attributes.firstName}}?</span></h3><div class="pricing-plan"><div class="vld-cir">1</div><div class="price">£99.99</div><h3>Unlimited Access<br />Annually</h3><p>Lorem ipsum dolor sit amet, consectetur adipisicing. Eume repellat tempore laudantium cumque dolorem.</p><button class="plan-select" type="button" data-plan="1">Select</button></div><div class="pricing-plan"><div class="vld-cir">2</div><div class="price">£9.99</div><h3>Unlimited Access<br />Monthly</h3><p>Lorem ipsum dolor sit amet, consectetur adipisicing. Eume repellat tempore laudantium cumque dolorem.</p><button class="plan-select" type="button" data-plan="2">Select</button></div><button class="plan-confirm" type="button">Confirm</button><div class="beige or">or</div><a class="btn-can plan-back">Back</a></div></div>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.$el.html(this.template(this.model)),this.delegateEvents({"click .plan-select":"planSelect","click .plan-confirm":"planConfirm","click .plan-back":"planBack"}),this},keyEvent:function(a){var b=a.which;27==b?this.planBack():13==b&&this.planConfirm()},planBack:function(){var a=new RegisterView({model:this.model});app.showView(a)},planSelect:function(a){var b=$(a.currentTarget).data("plan");this.model.set({plan:b})},planConfirm:function(){if(this.model.get("plan")){var a=new PaymentView({model:this.model});app.showView(a)}else this.$el.find("h2 span").hide().text("OOPS!").addClass("text-animate-ib"),this.$el.find("h3 span").hide().text("Please choose a pricing plan to continue.").addClass("text-animate-ib")}}),PaymentView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-reg"><div class="payment-header"><h2><span>Enter Your Payment Details</span></h2><h3><span>Almost got your Houston account!</span></h3></div><div class="payment-form-wrap"><div class="payment-houston"></div><form id="form-payment" action=""><span class="payment-errors"></span><div class="card-front"><div class="form-row"><label for="card-number">Card Number</label><input id="card-number" type="text" maxlength="20" data-stripe="number" /></div><div class="form-row expiration-date"><label for="expiration-month">Expiration Date</label><input id="expiration-month" type="text" maxlength="2" data-stripe="exp-month" placeholder="MM"/><input type="text" maxlength="4" data-stripe="exp-year" placeholder="YYYY"/></div><div class="form-row"><label for="cardholder-name">Cardholder Name</label><input id="cardholder-name" type="text" /></div></div><div class="card-back"><div class="form-row"><label for="cvc">CVC/CVV</label><input id="cvc" type="text" maxlength="4" data-stripe="cvc" /><div><span>The last </span><span>3 or 4 digits </span><span>on back </span><span>of the card</span></div></div></div><div class="payment-buttons"><button class="payment-confirm" type="button"><span>Confirm</span><img class="svg-dots" src="/application/assets/img/three-dots.svg" width="52" alt="Loading"></button><div class="beige or">or</div><a class="btn-can payment-back">Back</a></div><div class="powered-by-stripe"></div></form></div></div>'),templateSuccess:Handlebars.compile('<div class="box box-suc"><h2>You Have a Houston Account!</h2><h3>Hoot have thought it would be so easy?</h3><div class="got-wrap"><h2>You\'ve Got Mail!</h2><h3>Please click the verification link in the email we just sent you to complete your account creation</h3></div></div>'),initialize:function(){_.bindAll(this,"keyEvent"),$(document).bind("keydown",this.keyEvent)},onClose:function(){$(document).unbind("keydown",this.keyEvent)},render:function(){return this.$el.html(this.template(this.model)),this.delegateEvents({"click .payment-confirm":"paymentConfirm","click .payment-back":"paymentBack"}),this},keyEvent:function(a){var b=a.which;27==b?this.paymentBack():13==b&&this.paymentConfirm()},paymentConfirm:function(){var a=this.$el.find("form");app.currentView.$el.find("h2 span").show().removeClass("text-animate-ib"),app.currentView.$el.find("h3 span").show().removeClass("text-animate-ib"),this.paymentValidate(a)&&(a.find(".payment-confirm").prop("disabled",!0).addClass("loading"),Stripe.card.createToken(a,this.responseHandler))},paymentValidate:function(a){var b=!0,c=a.find('input[type="text"]');return c.each(function(){var a=$(this);a.val()?a.removeClass("error"):(a.addClass("error"),b=!1)}),b},paymentBack:function(){var a=new PlanView({model:this.model});app.showView(a)},responseHandler:function(a,b){b.error?(app.currentView.$el.find("h2 span").hide().text("OOPS!").addClass("text-animate-ib"),app.currentView.$el.find("h3 span").hide().text("There was an error with your card details, please try again.").addClass("text-animate-ib"),app.currentView.$el.find(".payment-confirm").prop("disabled",!1).removeClass("loading")):(app.currentView.model.set({stripeToken:b.id}),app.currentView.model.save(app.currentView.model.attributes,{success:function(a,b,c){console.log(b),app.currentView.$el.html(app.currentView.templateSuccess())},error:function(a,b,c){console.log(b)}}))}}),ResetView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/#/register">Try Houston for 60 days, absolutely free!</a></div><div class="box box-log"><h2>Change Password</h2><h3 class="log-tag">Please enter a new password below</h3><form id="form-pass-confirm"><input class="required" type="password" name="pass" placeholder="Password" /><input class="required" type="password" name="pass-c" placeholder="Confirm Password" /><button class="reset" type="button">Confirm</button><div class="beige">or</div><a class="btn-can">Cancel</a></form></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/#/register">Lets Go</a></div>'),render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .reset":"reset","input input":"resetErrorMessage"}),this},resetErrorMessage:function(){this.$el.find("h2").show().removeClass("text-animate"),this.$el.find("h3.log-tag").show().removeClass("text-animate")},reset:function(){if(login.validateForm(this.$el.find("#form-pass-confirm"))){if(this.$el.find("input[name=pass]").val()!==this.$el.find('input[name="pass-c"]').val())return this.$el.find(".box-log h2").hide().text("Oops!").addClass("text-animate"),void this.$el.find(".box-log h3.log-tag").hide().text("Please ensure passwords match").addClass("text-animate");this.model.url="/api/auth/reset/complete",this.model.set({password:this.$el.find('input[name="pass-c"]').val()}),this.model.save(this.model.attributes,{success:function(a,b,c){window.location.href="/"},error:_.bind(function(){this.$el.find(".box-log h2").hide().text("Oops!").addClass("text-animate"),this.$el.find(".box-log h3.log-tag").hide().text("Something went wrong").addClass("text-animate")},this)})}}}),ValidateView=Backbone.View.extend({template:Handlebars.compile('<div class="box box-wel"><h2>Welcome to Houston</h2><h3 class="wel-tag">Super-fast, easy to use frontline support</h3><h3>Get Houston!</h3><a href="/#/register">Try Houston for 60 days, absolutely free!</a></div><div class="box box-log"><h2>Set Password</h2><h3 class="verify-tag">Please set your password below</h3><form id="form-verify"><input class="required" type="password" name="pass" placeholder="Password" /><input class="required" type="password" name="pass-c" placeholder="Confirm Password" /><button class="validate" type="button">Login</button></form></div><div class="box box-try"><h2>Try Houston</h2><h3>Get your clients and support team using Houston with a 60 day free trial!</h3><a class="btn" href="/#/register">Lets Go</a></div>'),render:function(){return this.$el.html(this.template()),this.delegateEvents({"click .validate":"validate","input input":"resetErrorMessage"}),this},resetErrorMessage:function(){this.$el.find("h2").show().removeClass("text-animate"),this.$el.find("h3.verify-tag").show().removeClass("text-animate")},validate:function(){if(login.validateForm(this.$el.find("#form-verify"))){if(this.$el.find("input[name=pass]").val()!==this.$el.find('input[name="pass-c"]').val())return this.$el.find(".box-log h2").hide().text("Oops!").addClass("text-animate"),void this.$el.find(".box-log h3.verify-tag").hide().text("Please ensure passwords match").addClass("text-animate");this.model.url="/api/verify",this.model.set({password:this.$el.find('input[name="pass-c"]').val()}),this.model.save(this.model.attributes,{success:function(a,b,c){window.location.href="/profile"},error:_.bind(function(a,b){console.log(b),this.$el.find(".box-log h2").hide().text("Oops!").addClass("text-animate"),this.$el.find(".box-log h3.verify-tag").hide().text("Something went wrong").addClass("text-animate")},this)})}}});Backbone.View.prototype.close=function(){this.remove(),this.unbind(),this.onClose&&this.onClose()};var AppRouter=Backbone.Router.extend({root:"/",routes:{"":"login","reset/:token":"reset","verify/:token":"validate",register:"register","*notFound":"login"},currentView:!1,showView:function(a){this.appElement||(this.appElement=$("#app")),this.currentView&&this.currentView.close(),this.currentView=a,this.appElement.html(this.currentView.render().el)},login:function(){var a=new LoginView;this.showView(a)},reset:function(a){var b=new Backbone.Model;b.set("token",a);var c=new ResetView({model:b});this.showView(c)},validate:function(a){var b=new Backbone.Model;b.set("token",a);var c=new ValidateView({model:b});this.showView(c)},register:function(){var a=new RegisterModel,b=new RegisterView({model:a});this.showView(b)}}),app=new AppRouter;$(function(){Backbone.history.start({pushState:!0,root:app.root})}),$(document).on("click","a[href]:not([data-bypass])",function(a){var b={prop:$(this).prop("href"),attr:$(this).attr("href")},c=location.protocol+"//"+location.host+app.root;b.prop.slice(0,c.length)===c&&(a.preventDefault(),Backbone.history.navigate(b.attr,!0))}),String.prototype.capitalize=function(){return this.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})};var login={validateForm:function(a){var b=!0,c=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,a=$(a),d=a.find(".required");return d.each(function(){var a=$(this);""==a.val()?(a.addClass("error"),b=!1):a.removeClass("error"),a.is("input[type=email]")&&(address=a.val(),c.test(address)?a.removeClass("error"):(b=!1,a.addClass("error")))}),b},inputValidation:function(a){var b=!0,a=$(a),c=a.val(),d=c.length,e=a.data("vld"),f=a.closest(".vld-wrap");c||(b=!1),b&&(a.is("input[type=email]")&&(b=this.emailValidation(a,c,f,e)),a.hasClass("company")&&this.companyValidation(a,c,f,e),a.hasClass("reg-p")&&(b=this.passwordValidation(c,d)),a.hasClass("inp-lst")&&(b=this.repeatPasswordValidation(c))),b?f.addClass(e):f.removeClass(e),(a.hasClass("reg-p")||a.hasClass("inp-lst"))&&this.registerHideAlert(a)},emailValidation:function(a,b,c,d){var e=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i;if(!e.test(b))return a.addClass("error"),c.removeClass(d),!1;a.removeClass("error");var f=$.get("/api/check/email?email="+b);f.done(function(b){login.successfulAjaxValidation(a,c,d)}),f.fail(function(b,e){login.failedAjaxValidation(a,c,d)})},companyValidation:function(a,b,c,d){var e=$.get("/api/check/company?company="+b);e.done(function(b){login.successfulAjaxValidation(a,c,d)}),e.fail(function(b,e){login.failedAjaxValidation(a,c,d)})},successfulAjaxValidation:function(a,b,c){a.removeClass("in-use"),a.closest(".reg-vrf").find(".vrf").fadeOut(),b.addClass(c)},failedAjaxValidation:function(a,b,c){a.addClass("in-use"),a.closest(".reg-vrf").find(".vrf").show().addClass("delayed-icon-animate"),b.removeClass(c)},validatedPassword:!1,passwordValidation:function(a,b){return b>=8?(this.validatedPassword=a,!0):!1},registerHideAlert:function(a){$(a).removeClass("password-resize").closest(".reg-vrf").find(".vrf").fadeOut()},repeatPasswordValidation:function(a){return a==this.validatedPassword?!0:!1},registerPasswordShowCount:function(a){var a=$(a);login.validatedPassword!==a.val()&&(a.addClass("password-resize"),a.closest(".reg-vrf").find(".vrf").show().addClass("delayed-icon-animate"))},registerPasswordCount:function(a,b){var a=$(a),c=a.val().length,d=a.closest(".reg-vrf"),e=d.find(".vrf-count"),f=8,g=b.find(".inp-lst");8>c?(a.addClass("password-resize"),e.text(f-c),e.removeClass("ok"),this.validatedPassword=!1,d.find(".vrf").show().addClass("delayed-icon-animate"),g.val(""),g.prop("disabled",!0),g.closest(".reg-vrf").find(".vrf").fadeOut(),g.closest(".vld-wrap").removeClass("vld-a vld-b")):(e.html('<i class="icon-ok-1"></i>'),e.addClass("ok"),g.prop("disabled",!1))},registerPasswordMatch:function(a){var a=$(a),b=a.val(),c=a.closest(".reg-vrf"),d=c.find(".vrf"),e=a.data("vld"),f=a.closest(".vld-wrap");if(b==this.validatedPassword){a.addClass("password-resize");var g=d.find(".vrf-cir"),h=d.find(".vrf-msg");g.addClass("ok").html('<i class="icon-ok-1"></i>'),h.html(""),d.show().addClass("delayed-icon-animate"),f.addClass(e)}else d.fadeOut(),f.removeClass(e)},registerCreateValidate:function(a){return 3==a.find("div.vld-a").length&&3==a.find("div.vld-b").length?!0:!1}};